generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum OAUTH_PROVIDER {
  GOOGLE
  MICROSOFT
  GITHUB
  EMAIL_PASSWORD
}

enum ORG_USER_ROLE {
  ADMIN
  MEMBER
}

model User {
  id                  String             @id @default(auto()) @map("_id") @db.ObjectId
  email               String             @unique
  emailVerified       Boolean            @default(false)
  name                String
  hash                String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @default(now())
  oAuthProviders      OAuthProvider[]
  picture             String?
  code                Code?
  organization        Organization?
  partOfOrganizations OrganizationMate[]
  Service             Service[]
}

model OAuthProvider {
  id         String         @id @default(auto()) @map("_id") @db.ObjectId
  userId     String         @db.ObjectId
  user       User           @relation(fields: [userId], references: [id])
  provider   OAUTH_PROVIDER
  providerId String?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @default(now())
}

model Code {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userId            String  @unique @db.ObjectId
  user              User    @relation(fields: [userId], references: [id])
  refresh           Secret?
  emailVerification Secret?
  registration      Secret?
  forgetPassword    Secret?
}

type Secret {
  value String
  exp   Int
}

model Organization {
  id           String             @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  website      String
  teamSize     Int
  industryType String
  personaType  String
  approachFrom String
  isActivated  Boolean            @default(true)
  isDeleted    Boolean            @default(false)
  ownerId      String             @unique @db.ObjectId
  owner        User               @relation(fields: [ownerId], references: [id])
  members      OrganizationMate[]
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @default(now())
  Service      Service[]
}

model OrganizationMate {
  id             String        @id @default(auto()) @map("_id") @db.ObjectId
  userId         String        @db.ObjectId
  user           User          @relation(fields: [userId], references: [id])
  role           ORG_USER_ROLE
  organizationId String        @db.ObjectId
  organization   Organization? @relation(fields: [organizationId], references: [id])
}

model Service {
  id             String        @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  proxyPath      String
  proxyServerUrl String
  organizationId String        @db.ObjectId
  organization   Organization? @relation(fields: [organizationId], references: [id])
  userId         String        @db.ObjectId
  user           User          @relation(fields: [userId], references: [id])
  isActivated    Boolean       @default(true)
  isDeleted      Boolean       @default(false)
  clientId       String        @unique
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now())
}
